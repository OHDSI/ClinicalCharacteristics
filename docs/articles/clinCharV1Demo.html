<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clinical Characteristics V1 demo • ClinicalCharacteristics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Clinical Characteristics V1 demo">
<meta property="og:description" content="ClinicalCharacteristics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ClinicalCharacteristics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clinChar_demo.html">How to use ClinicalCharacteristics</a>
    </li>
    <li>
      <a href="../articles/clinCharV1Demo.html">Clinical Characteristics V1 demo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Clinical Characteristics V1 demo</h1>
            
      
      
      <div class="hidden name"><code>clinCharV1Demo.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ClinicalCharacteristics</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We introduce a new R package called ClinicalCharacteristics which is
a table-shell approach to characterization in real-world data mapped to
the OMOP CDM. The purpose of introducing this package was to deal with
table-shells in studies. Often we encounter situations where our study
counter-parts wish to characterize an indication based on a series of
specific comorbidities identified using a set of codes. Using base OHDSI
tools this request is becomes non-trivial, involving lots of
data-wrangling. Our goal was to build a tool that could characterize
specific comorbidities of interest and only pull results of interest
omitting superflous output.</p>
<div class="section level3">
<h3 id="good-ole-featureextraction">Good ole’ <code>FeatureExtraction</code><a class="anchor" aria-label="anchor" href="#good-ole-featureextraction"></a>
</h3>
<p>The common characterization tool <code>FeatureExtraction</code> was
designed for drawing as many arbitrary features for high-dimenionsal
modelling. In the modelling situation, it is to our advantage to pull
any concept from a domain table to use in a model and optimize its fit.
Further, a handy side-effect of <code>FeatureExtraction</code> is its
ability to quantify counts and proportions for the presence of concepts.
This is a fantastic tool that has been a cornerstone in OHDSI software
for many years. However, it yields output that either requires
additional data wrangling or does not quite answer the specified
characterization. The alternative is to write custom sql to
characterize. While this solution solves the immediate project problem
it no longer abides by standardized analytics which is cornerstone to
network studies.</p>
</div>
<div class="section level3">
<h3 id="clinicalcharacteristics-input">ClinicalCharacteristics Input<a class="anchor" aria-label="anchor" href="#clinicalcharacteristics-input"></a>
</h3>
<p>A characterization requires input based on: one, the target cohort to
use as a reference point; two, a time window to observe the occurrence
of a characteristic; and three identification of a characteristic listed
as follows:</p>
<ul>
<li>ConceptSet: a set of concepts when bundled identify a clinical
event. For example, identification of Type 2 Diabetes could be done with
SNOMED concept plus descendant concepts.</li>
<li>Cohort: a cohort identifying a clinical event. For example
identification of patients with Type 2 Diabetes who enter the cohort
with a SNOMED concept and exit the cohort at the end of continuous
observation</li>
<li>ConceptSetGroup: bundling of multiple concept sets to identify a
clinical event. For example identification of Smoking using a condition
SNOMED concept and a concept in the observation table.</li>
<li>Demographic: identification of a person characteristic such as age,
gender, race, and ethnicity among others.</li>
</ul>
<p>For concept sets, cohorts and concept set groups, this tool can
handle the following types of aggregations:</p>
<ul>
<li>Presence: identification of characteristic in a specified time
window</li>
<li>Count: enumeration of characteristic in a specified time window</li>
<li>TimeDiff: summary of time from the cohort index to the event
date</li>
</ul>
<p>The final feature implemented in <code>ClinicalCharacteristics</code>
is how to report a characteristic; either categorizing a continuous
variable or scoring a categorical variable. For example, we can choose
to report the distribution of age in 5 year, 10 year or another custom
grouping. Another example we can categorize the number of SGLT2
medications taken in a time window by converting the continuous count to
a categorical break (eg. 1, 2, 3, 4+ prescriptions). Finally we can
score a categorical variable by applying a weight to the presence of a
comorbidity (a Charlson score for example).</p>
</div>
<div class="section level3">
<h3 id="clinicalcharacteristics-design">ClinicalCharacteristics Design<a class="anchor" aria-label="anchor" href="#clinicalcharacteristics-design"></a>
</h3>
<p>The design of ClinicalCharacteristics follows a simple workflow
implemented in SQL.</p>
<ul>
<li>Step 0: Implement meta table for table shell</li>
<li>Step 1: Identify occurrences of a clinical characteristic</li>
<li>Step 2: Synthesize occurrences to “1 row per patient”</li>
<li>Step 3: Aggregate patient level data in the database</li>
<li>Step 4: Clean and label aggregate table for saving and
presentation</li>
</ul>
<p>Similar to circe, <code>ClinicalCharacteristics</code> takes the
input of the table shell specification and renders a sql file to build
the table shell. The routing of these steps is handled in R, using R6
classes.</p>
<div class="section level4">
<h4 id="roadmap">Roadmap<a class="anchor" aria-label="anchor" href="#roadmap"></a>
</h4>
<p>This R package is still under-development as of its presentation at
the 2024 OHDSI symposium. An earlier version of the package (<a href="https://github.com/OHDSI/ClinicalCharacteristics" class="external-link">v0.3.4</a>) is
available for use but will be subject to major refactoring.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We provide an example for running
<code>ClinicalCharacteristics</code> below:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># create execution settings R6 class</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>executionSettings <span class="ot">&lt;-</span> <span class="fu">createExecutionSettings</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">connectionDetails =</span> connectionDetails,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">cdmDatabaseSchema =</span> <span class="st">"cdm_schema"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">workDatabaseSchema =</span> <span class="st">"work_schema"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="at">tempEmulationSchema =</span> <span class="st">"temp_schema"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">targetCohortTable =</span> <span class="st">"cohorts"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">cdmSourceName =</span> <span class="st">"my_omop_data"</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co"># Using CAPR to create concept sets to implement in ClinChar</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="fu">library</span>(Capr)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="do">## baseline conditions</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>cs1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>  <span class="st">'hf'</span> <span class="ot">=</span> <span class="fu">cs</span>(<span class="fu">descendants</span>(<span class="dv">316139</span>), <span class="at">name =</span> <span class="st">"hf"</span>),</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>  <span class="st">'ckd'</span> <span class="ot">=</span> <span class="fu">cs</span>(<span class="fu">descendants</span>(<span class="dv">46271022</span>), <span class="at">name =</span> <span class="st">"ckd"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="do">## drugs</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>cs2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>  <span class="st">'metformin'</span> <span class="ot">=</span> <span class="fu">cs</span>(<span class="fu">descendants</span>(<span class="dv">1503297</span>), <span class="at">name =</span> <span class="st">"metformin"</span>),</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>  <span class="st">'sglt2'</span> <span class="ot">=</span> <span class="fu">cs</span>(<span class="fu">descendants</span>(<span class="dv">1123627</span>), <span class="at">name =</span> <span class="st">"sglt2"</span>)</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>)</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co"># Identification of time windows</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>tw <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>  <span class="fu">timeInterval</span>(<span class="at">lb =</span> <span class="sc">-</span><span class="dv">365</span>, <span class="at">rb =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>)</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>tw1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>  <span class="fu">timeInterval</span>(<span class="at">lb =</span> <span class="dv">0</span>, <span class="at">rb =</span> <span class="dv">90</span>),</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>  <span class="fu">timeInterval</span>(<span class="at">lb =</span> <span class="dv">0</span>, <span class="at">rb =</span> <span class="dv">365</span>)</span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>)</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co"># Specification of Table Shell</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>tableShell <span class="ot">&lt;-</span> <span class="fu">createTableShell</span>(</span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Test"</span>,</span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>  <span class="at">targetCohorts =</span> <span class="fu">list</span>(</span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>    <span class="fu">createCohortInfo</span>(<span class="at">id =</span> <span class="dv">1</span>, <span class="at">name =</span> <span class="st">"T2D"</span>)</span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>  ),</span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>  <span class="at">lineItems =</span> <span class="fu">lineItems</span>(</span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>    <span class="fu">createAgeLineItem</span>()),</span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>    <span class="fu">createGenderLineItem</span>(),</span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>    <span class="fu">createConceptSetLineItemBatch</span>(</span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Baseline Conditions"</span>,</span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>      <span class="at">domain =</span> <span class="st">"condition_occurrence"</span>,</span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>      <span class="at">statistic =</span> <span class="fu">createPresence</span>(),</span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>      <span class="at">conceptSets =</span> cs1,</span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a>      <span class="at">timeInterval =</span> tw</span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a>    ),</span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a>    <span class="fu">createConceptSetLineItemBatch</span>(</span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Drug Usage"</span>,</span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a>      <span class="at">domain =</span> <span class="st">"drug_exposure"</span>,</span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>      <span class="at">statistic =</span> <span class="fu">createPresence</span>(),</span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a>      <span class="at">conceptSets =</span> cs2,</span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a>      <span class="at">timeIntervals =</span> tw1</span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a>    )</span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a>  )</span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="er">)</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="co"># generation of table shell</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">generateTableShell</span>(tableShell, executionSettings)</span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a><span class="co"># review sql</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a><span class="fu">reviewTableShellSql</span>(<span class="at">tableShell =</span> tableShell, executionSettings)</span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a><span class="co"># explore results</span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a><span class="fu">previewTableShell</span>(res, <span class="at">type =</span> <span class="st">"continuous"</span>)</span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a><span class="fu">previewTableShell</span>(res, <span class="at">type =</span> <span class="st">"categorical"</span>)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin Lavallee, Katy Sadowski, Ajit Londhe.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
